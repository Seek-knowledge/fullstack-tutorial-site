<!DOCTYPE html>
<html lang="en-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前言 | Full Stack Developer Tutorial</title>
    <meta name="description" content="from zero to hero">
    <link rel="icon" href="/fullstack-tutorial-site/favicon.ico">
    
    <link rel="preload" href="/fullstack-tutorial-site/assets/css/styles.e23029aa.css" as="style"><link rel="preload" href="/fullstack-tutorial-site/assets/js/app.e23029aa.js" as="script"><link rel="preload" href="/fullstack-tutorial-site/assets/js/4.020e03fa.js" as="script"><link rel="prefetch" href="/fullstack-tutorial-site/assets/css/10.styles.e7bfa7b0.css"><link rel="prefetch" href="/fullstack-tutorial-site/assets/css/7.styles.a8031ade.css"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/1.82e55b14.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/10.e7bfa7b0.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/11.42acfd5a.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/12.f0884d8e.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/13.c57f5837.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/14.07fd252d.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/15.9dcc583e.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/16.42bd51ad.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/17.f0e20aa7.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/18.62b756df.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/19.732a8ec2.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/2.57da3069.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/20.1cd96f80.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/21.e3ef896c.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/22.8dd77b6a.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/23.5ae08c37.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/24.5a34ccb1.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/25.7dee6df6.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/26.af9b2812.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/27.6f5b260d.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/28.c5f782da.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/29.799a3dea.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/3.4193afeb.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/30.8bb33866.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/31.a2bf48a5.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/32.2dd32760.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/33.8b1034f7.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/34.8e3964bc.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/35.57d9f500.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/36.49aead0e.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/37.60183b23.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/38.3416c1ac.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/39.cc8bcef9.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/40.ffb34422.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/41.feec12a7.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/42.4e1803cc.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/43.6a56bbfb.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/44.ef11fafe.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/45.6b3189d2.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/46.cf48bc8c.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/47.bbcdd89a.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/48.9ad3fe5a.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/49.c4eb64f9.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/5.f4777b53.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/50.79d979ac.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/51.bee6678b.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/52.5e069c45.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/53.b4ed7749.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/54.37b05d6c.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/55.9497455f.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/56.7459f398.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/57.a21a8691.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/58.5c0b7c68.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/59.083c760f.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/6.0c32f6b7.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/60.881f6ac9.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/61.ebc72343.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/62.3514484e.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/63.39076018.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/64.20372ac4.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/65.cc25487c.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/66.e130b690.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/67.40d544ec.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/68.371c66ba.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/69.bf625d87.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/7.a8031ade.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/70.53616ef1.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/71.1e855d2c.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/72.ebb7d332.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/73.7b72b76a.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/74.7f93f494.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/8.27947311.js"><link rel="prefetch" href="/fullstack-tutorial-site/assets/js/9.ca56268b.js">
    <link rel="stylesheet" href="/fullstack-tutorial-site/assets/css/styles.e23029aa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fullstack-tutorial-site/" class="home-link router-link-active"><!----> <span class="site-name">Full Stack Developer Tutorial</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fullstack-tutorial-site/notes/" class="nav-link router-link-active">全栈指南</a></div><div class="nav-item"><a href="/fullstack-tutorial-site/notes/archives/" class="nav-link">场景实战</a></div><div class="nav-item"><a href="/fullstack-tutorial-site/vuepress/donate/" class="nav-link">捐赠</a></div><div class="nav-item"><a href="/fullstack-tutorial-site/vuepress/author/" class="nav-link">作者</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择/语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fullstack-tutorial-site/notes/JavaWeb/Spring.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----> <a href="/fullstack-tutorial-site/zh/" class="nav-link">zh-US</a></li></ul></div></div> <a href="https://github.com/frank-lam/fullstack-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fullstack-tutorial-site/notes/" class="nav-link router-link-active">全栈指南</a></div><div class="nav-item"><a href="/fullstack-tutorial-site/notes/archives/" class="nav-link">场景实战</a></div><div class="nav-item"><a href="/fullstack-tutorial-site/vuepress/donate/" class="nav-link">捐赠</a></div><div class="nav-item"><a href="/fullstack-tutorial-site/vuepress/author/" class="nav-link">作者</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择/语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fullstack-tutorial-site/notes/JavaWeb/Spring.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----> <a href="/fullstack-tutorial-site/zh/" class="nav-link">zh-US</a></li></ul></div></div> <a href="https://github.com/frank-lam/fullstack-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav> <div class="load-success"><div id="codefund_ad"></div></div> <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Get Start</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/fullstack-tutorial-site/notes/" class="sidebar-link">快速开始</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Java 技术栈</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/fullstack-tutorial-site/notes/JavaArchitecture/01 Java 基础.html" class="sidebar-link">Java 基础概念</a></li><li><a href="/fullstack-tutorial-site/notes/JavaArchitecture/02 Java 集合框架.html" class="sidebar-link">Java 集合框架</a></li><li><a href="/fullstack-tutorial-site/notes/JavaArchitecture/03 Java 并发编程.html" class="sidebar-link">Java 并发编程</a></li><li><a href="/fullstack-tutorial-site/notes/JavaArchitecture/04 Java IO.html" class="sidebar-link">Java I/O</a></li><li><a href="/fullstack-tutorial-site/notes/JavaArchitecture/05 Java 虚拟机.html" class="sidebar-link">Java 虚拟机</a></li><li><a href="/fullstack-tutorial-site/notes/JavaArchitecture/07 Java Web.html" class="sidebar-link">Java Web</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>数据库</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/fullstack-tutorial-site/notes/MySQL.html" class="sidebar-link">前言</a></li><li><a href="/fullstack-tutorial-site/notes/SQL.html" class="sidebar-link">前言</a></li><li><a href="/fullstack-tutorial-site/notes/Redis.html" class="sidebar-link">前言</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><p>[TOC]</p> <ul><li><a href="#%E5%89%8D%E8%A8%80">前言</a></li> <li><a href="#%E4%B8%80%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5">一、基础概念</a> <ul><li><a href="#1-javabean">1. JavaBean</a></li> <li><a href="#2-bean">2. Bean</a></li> <li><a href="#3-%E4%BC%A0%E7%BB%9Fjavabean%E4%B8%8Espring%E4%B8%AD%E7%9A%84bean%E7%9A%84%E5%8C%BA%E5%88%AB">3. 传统Javabean与Spring中的bean的区别</a></li> <li><a href="#4-pojo">4. POJO</a></li></ul></li> <li><a href="#%E4%BA%8Cspring%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF">二、Spring核心技术</a> <ul><li><a href="#1-ioc%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC">1. IOC（控制反转）</a> <ul><li><a href="#11-%E4%BB%80%E4%B9%88%E6%98%AFioc">1.1 什么是IOC</a></li> <li><a href="#12-ioc%E8%83%BD%E5%81%9A%E4%BB%80%E4%B9%88">1.2 IoC能做什么</a></li> <li><a href="#13-ioc%E5%92%8Cdi">1.3 IoC和DI</a></li> <li><a href="#14-ioc%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86-%E9%99%8D%E4%BD%8E%E7%B1%BB%E4%B9%8B%E9%97%B4%E7%9A%84%E8%80%A6%E5%90%88%E5%BA%A6">1.4 IOC底层原理 (降低类之间的耦合度)</a></li> <li><a href="#15-spring%E4%B8%AD%E6%80%8E%E4%B9%88%E7%94%A8">1.5 Spring中怎么用</a> <ul><li><a href="#1%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%96%B9%E5%BC%8F">（1）配置文件方式</a></li> <li><a href="#2%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F">（2）注解方式</a></li></ul></li></ul></li> <li><a href="#2-di%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5">2. DI（依赖注入）</a> <ul><li><a href="#21-%E4%BB%80%E4%B9%88%E6%98%AF%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5">2.1 什么是依赖注入</a></li> <li><a href="#22-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5">2.2 为什么使用依赖注入</a></li> <li><a href="#23-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%AE%9E%E7%8E%B0%E6%9D%BE%E8%80%A6%E5%90%88">2.3 为什么要实现松耦合</a></li> <li><a href="#24-ioc%E5%92%8Cdi%E5%8C%BA%E5%88%AB">2.4 IOC和DI区别</a></li> <li><a href="#25-%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E6%96%B9%E5%BC%8F">2.5 依赖注入方式</a> <ul><li><a href="#1%E4%BD%BF%E7%94%A8set%E6%96%B9%E6%B3%95%E6%B3%A8%E5%85%A5">（1）使用set方法注入</a></li> <li><a href="#2%E4%BD%BF%E7%94%A8%E6%9C%89%E5%8F%82%E6%9E%84%E9%80%A0%E6%B3%A8%E5%85%A5">（2）使用有参构造注入</a></li> <li><a href="#3%E6%B3%A8%E5%85%A5%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B%E5%B1%9E%E6%80%A7">（3）注入对象类型属性</a></li> <li><a href="#4p%E5%90%8D%E7%A7%B0%E7%A9%BA%E9%97%B4%E6%B3%A8%E5%85%A5">（4）p名称空间注入</a></li> <li><a href="#5%E6%B3%A8%E5%85%A5%E5%A4%8D%E6%9D%82%E7%B1%BB%E5%9E%8B%E5%B1%9E%E6%80%A7">（5）注入复杂类型属性</a></li></ul></li></ul></li> <li><a href="#3-aop%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B">3. AOP（面向切面编程）</a> <ul><li><a href="#31-%E4%BB%80%E4%B9%88%E6%98%AFaop">3.1 什么是AOP</a></li> <li><a href="#32-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86">3.2 底层原理</a> <ul><li><a href="#%E7%AC%AC%E4%B8%80%E7%A7%8D-jdk-%E8%87%AA%E5%B8%A6%E7%9A%84%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E6%8A%80%E6%9C%AF">第一种 JDK 自带的动态代理技术</a></li> <li><a href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D-cglibcodegenerationlibrary%E6%98%AF%E4%B8%80%E4%B8%AA%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE">第二种 CGLIB(CodeGenerationLibrary)是一个开源项目</a></li></ul></li> <li><a href="#33-aop%E6%93%8D%E4%BD%9C%E6%9C%AF%E8%AF%AD">3.3 AOP操作术语</a></li> <li><a href="#34-spring%E7%9A%84aop%E6%93%8D%E4%BD%9C">3.4 Spring的AOP操作</a> <ul><li><a href="#1aop%E5%87%86%E5%A4%87%E6%93%8D%E4%BD%9C">（1）AOP准备操作</a></li> <li><a href="#2%E4%BD%BF%E7%94%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F%E9%85%8D%E7%BD%AE%E5%88%87%E5%85%A5%E7%82%B9">（2）使用表达式配置切入点</a></li></ul></li> <li><a href="#35-%E4%BD%BF%E7%94%A8xml%E5%AE%9E%E7%8E%B0aop">3.5 使用xml实现AOP</a></li> <li><a href="#36-%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0aop">3.6 使用注解实现AOP</a></li> <li><a href="#37-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F">3.7 为什么需要代理模式？</a></li> <li><a href="#38-%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86">3.8 静态代理</a></li> <li><a href="#39-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E4%BD%BF%E7%94%A8jdk%E5%86%85%E7%BD%AE%E7%9A%84proxy%E5%AE%9E%E7%8E%B0">3.9 动态代理，使用JDK内置的Proxy实现</a></li> <li><a href="#310-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E4%BD%BF%E7%94%A8cglib%E5%AE%9E%E7%8E%B0">3.10 动态代理，使用cglib实现</a></li></ul></li> <li><a href="#4-spring-ioc%E5%AE%B9%E5%99%A8">4. Spring Ioc容器</a> <ul><li><a href="#41-bean%E4%BD%9C%E7%94%A8%E5%9F%9F">4.1 Bean作用域</a></li> <li><a href="#42-bean-%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">4.2 Bean 的生命周期</a></li> <li><a href="#43-beanfactory-%E5%92%8Capplicationcontextbean%E5%B7%A5%E5%8E%82%E5%92%8C%E5%BA%94%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87">4.3 BeanFactory 和ApplicationContext（Bean工厂和应用上下文）</a></li></ul></li></ul></li></ul> <h1 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h1> <p>为了更好的深入学习Spring核心技术，在这里整理了Spring相关的常见核心知识，和面试知识点，本文将通过浅显易懂的语言和代码实现，相信可以在最短的时间内进行巩固学习。</p> <p>本文参考：</p> <ul><li><a href="https://github.com/biezhi/java-bible/blob/master/ioc/index.md" target="_blank" rel="noopener noreferrer">理解并实现一个IOC容器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/Snailclimb/Java-Guide/blob/master/%E4%B8%BB%E6%B5%81%E6%A1%86%E6%9E%B6/Spring%E5%AD%A6%E4%B9%A0%E4%B8%8E%E9%9D%A2%E8%AF%95.md" target="_blank" rel="noopener noreferrer">【源码实现】Java-Guide/Spring学习与面试.md at master · Snailclimb/Java-Guide<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5aa7818af265da23844040c6" target="_blank" rel="noopener noreferrer">一起来谈谈 Spring AOP！ - 掘金<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/Only-lezi/spring-learning/tree/master/spring-learning-article" target="_blank" rel="noopener noreferrer">黑马程序员Spring2016学习笔记<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.cnblogs.com/best/p/5679656.html" target="_blank" rel="noopener noreferrer">Spring学习总结（二）——静态代理、JDK与CGLIB动态代理、AOP+IoC - 张果 - 博客园<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.zhihu.com/question/23277575/answer/169698662" target="_blank" rel="noopener noreferrer">Spring IoC有什么好处呢？ - 知乎<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://wiki.jikexueyuan.com/project/spring/transaction-management.html" target="_blank" rel="noopener noreferrer">极客学院Spring Wiki<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.w3cschool.cn/wkspring/f6pk1ic8.html" target="_blank" rel="noopener noreferrer">【必读】Spring W3Cschool教程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.zhihu.com/question/21142149" target="_blank" rel="noopener noreferrer">【必读】Java新手如何学习Spring、Struts、Hibernate三大框架？ - 知乎，深度好文<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>个人的使用体会</p> <ul><li><strong>spring</strong>：核心提供依赖注入</li> <li><strong>spring mvc</strong>： mvc框架</li> <li><strong>spring boot</strong>：说不太出什么感觉，跟mvc比就感觉配置少了好多</li> <li><strong>spring cloud</strong>：围绕微服务的一套东西</li></ul> <p>from 2018/7/27</p> <h1 id="一、基础概念"><a href="#一、基础概念" aria-hidden="true" class="header-anchor">#</a> 一、基础概念</h1> <h2 id="_1-javabean"><a href="#_1-javabean" aria-hidden="true" class="header-anchor">#</a> 1. JavaBean</h2> <p><strong>JavaBean是一种组件技术</strong>，就好像你做了一个扳子，而这个扳子会在很多地方被拿去用，这个扳子也提供多种功能(你可以拿这个扳子扳、锤、撬等等)，而这个扳子就是一个组件。</p> <p><strong>JavaBean是一个遵循特定写法的Java类</strong>，它通常具有如下特点：</p> <ul><li>这个Java类必须具有一个无参的构造函数</li> <li>属性必须私有化。</li> <li>私有化的属性必须通过public类型的方法暴露给其它程序，并且方法的命名也必须遵守一定的命名规范。</li> <li>这个类应是可序列化的。（比如可以实现Serializable 接口，用于实现bean的持久性）</li></ul> <p>许多开发者把JavaBean看作遵从特定命名约定的POJO。 简而言之，当一个POJO可序列化，有一个无参的构造函数，使用getter和setter方法来访问属性时，他就是一个JavaBean。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> gacl<span class="token punctuation">.</span>javabean<span class="token punctuation">.</span>study<span class="token punctuation">;</span>

<span class="token comment">/**
 * @author gacl
 * Person类就是一个最简单的JavaBean
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>

    <span class="token comment">//Person类封装的私有属性</span>
    <span class="token comment">// 姓名 String类型</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token comment">// 性别 String类型</span>
    <span class="token keyword">private</span> String sex<span class="token punctuation">;</span>
    <span class="token comment">// 年龄 int类型</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
  
   
    <span class="token comment">/**
     * 无参数构造方法
     */</span>
    <span class="token keyword">public</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span>
    
    <span class="token comment">//Person类对外提供的用于访问私有属性的public方法</span>
    <span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> String <span class="token function">getSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> sex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSex</span><span class="token punctuation">(</span>String sex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>JavaBean在J2EE开发中，通常用于封装数据，对于遵循以上写法的JavaBean组件，其它程序可以通过反射技术实例化JavaBean对象，并且通过反射那些遵守命名规范的方法，从而获知JavaBean的属性，进而调用其属性保存数据。</p> <h2 id="_2-bean"><a href="#_2-bean" aria-hidden="true" class="header-anchor">#</a> 2. Bean</h2> <ul><li><strong>Bean的中文含义是“豆子”，Bean的含义是可重复使用的Java组件</strong>。所谓组件就是一个由可以自行进行内部管理的一个或几个类所组成、外界不了解其内部信息和运行方式的群体。使用它的对象只能通过接口来操作。</li> <li>Bean并不需要继承特别的基类(BaseClass)或实现特定的接口(Interface)。Bean的编写规范使Bean的容器(Container)能够分析一个Java类文件，并将其方法(Methods)翻译成属性(Properties)，即把Java类作为一个Bean类使用。Bean的编写规范包括Bean类的构造方法、定义属性和访问方法编写规则。</li> <li>Java Bean是基于Java的组件模型，由<strong>属性、方法和事件</strong>3部分组成。在该模型中，JavaBean可以被修改或与其他组件结合以生成新组件或完整的程序。它是一种Java类，通过封装成为具有某种功能或者处理某个业务的对象。因此，也可以通过嵌在JSP页面内的Java代码访问Bean及其属性。</li></ul> <h2 id="_3-传统javabean与spring中的bean的区别"><a href="#_3-传统javabean与spring中的bean的区别" aria-hidden="true" class="header-anchor">#</a> 3. 传统Javabean与Spring中的bean的区别</h2> <p>Javabean已经没人用了</p> <p>springbean可以说是javabean的发展, 但已经完全不是一回事儿了</p> <p>**用处不同：**传统javabean更多地作为值传递参数，而spring中的bean用处几乎无处不在，任何组件都可以被称为bean。</p> <p>**写法不同：**传统javabean作为值对象，要求每个属性都提供getter和setter方法；但spring中的bean只需为接受设值注入的属性提供setter方法。</p> <p>**生命周期不同：**传统javabean作为值对象传递，不接受任何容器管理其生命周期；spring中的bean有spring管理其生命周期行为。</p> <p>所有可以被spring容器实例化并管理的java类都可以称为bean。</p> <p>原来服务器处理页面返回的值都是直接使用request对象，后来增加了javabean来管理对象，所有页面值只要是和javabean对应，就可以用类.GET属性方法来获取值。javabean不只可以传参数，也可以处理数据，相当与把一个服务器执行的类放到了页面上，使对象管理相对不那么乱（对比asp的时候所有内容都在页面上完成）。</p> <p>spring中的bean，是通过配置文件、javaconfig等的设置，有spring自动实例化，用完后自动销毁的对象。让我们只需要在用的时候使用对象就可以，不用考虑如果创建类对象（这就是spring的注入）。一般是用在服务器端代码的执行上。</p> <h2 id="_4-pojo"><a href="#_4-pojo" aria-hidden="true" class="header-anchor">#</a> 4. POJO</h2> <p>POJO 和JavaBean是我们常见的两个关键字，一般容易混淆，POJO全称是Plain Ordinary Java Object / Pure Old Java Object，中文可以翻译成：普通Java类，<strong>具有一部分getter/setter方法的那种类就可以称作POJO</strong>，但是JavaBean则比 POJO复杂很多， Java Bean 是可复用的组件，对 Java Bean 并没有严格的规范，理论上讲，任何一个 Java 类都可以是一个 Bean 。但通常情况下，由于 Java Bean 是被容器所创建（如 Tomcat) 的，所以 Java Bean 应具有一个无参的构造器，另外，通常 Java Bean 还要实现 Serializable 接口用于实现 Bean 的持久性。 Java Bean 是不能被跨进程访问的</p> <p>一般在web应用程序中建立一个数据库的映射对象时，我们只能称它为POJO。
POJO(Plain Old Java Object)这个名字用来强调它是一个普通java对象，而不是一个特殊的对象。
2005年11月时，“POJO”主要用来指代那些没用遵从特定的Java对象模型，约定或框架如EJB的Java对象.
理想地讲，一个POJO是一个不受任何限制的Java对象（除了Java语言规范）。例如一个POJO不应该是</p> <pre><code>  1. 扩展预定的类，如  public class Foo extends javax.servlet.http.HttpServlet { ...

  2. 实现预定的接口，如  public class Bar implements javax.ejb.EntityBean { ...

  3. 包含预定的标注，如  @javax.ejb.Entity public class Baz{ ...
</code></pre> <p>然后，因为技术上的困难及其他原因，许多兼容POJO风格的软件产品或框架事实上仍然要求使用预定的标注，譬如用于更方便的持久化。</p> <h1 id="二、spring核心技术"><a href="#二、spring核心技术" aria-hidden="true" class="header-anchor">#</a> 二、Spring核心技术</h1> <h2 id="_1-ioc（控制反转）"><a href="#_1-ioc（控制反转）" aria-hidden="true" class="header-anchor">#</a> 1. IOC（控制反转）</h2> <h3 id="_1-1-什么是ioc"><a href="#_1-1-什么是ioc" aria-hidden="true" class="header-anchor">#</a> 1.1 什么是IOC</h3> <p>IoC(Inversion of Control)，意为控制反转，不是什么技术，而是一种设计思想。Ioc意味着<strong>将你设计好的对象交给容器控制，而不是传统的在你的对象内部直接控制</strong>。</p> <p>如何理解好Ioc呢？理解好Ioc的关键是要明确“谁控制谁，控制什么，为何是反转（有反转就应该有正转了），哪些方面反转了”，那我们来深入分析一下：</p> <ul><li><strong>谁控制谁，控制什么</strong>：传统Java SE程序设计，我们直接在对象内部通过new进行创建对象，是程序主动去创建依赖对象；而IoC是有专门一个容器来创建这些对象，即由Ioc容器来控制对 象的创建；谁控制谁？当然是IoC 容器控制了对象；控制什么？那就是主要控制了外部资源获取（不只是对象包括比如文件等）。</li> <li><strong>为何是反转，哪些方面反转了</strong>：有反转就有正转，传统应用程序是由我们自己在对象中主动控制去直接获取依赖对象，也就是正转；而反转则是由容器来帮忙创建及注入依赖对象；为何是反转？因为由容器帮我们查找及注入依赖对象，对象只是被动的接受依赖对象，所以是反转；哪些方面反转了？依赖对象的获取被反转了。</li></ul> <p><strong>简单来说</strong></p> <blockquote><p>正转：比如有一个类，在类里面有方法（不是静态的方法），调用类里面的方法，创建类的对象，使用对象调用方法，创建类对象的过程，需要new出来对象</p> <p>反转：把对象的创建不是通过new方式实现，而是交给Spring配置创建类对象</p></blockquote> <p>【必读】IOC深度理解，请转向：<a href="/fullstack-tutorial-site/notes/JavaWeb/深入浅出IOC.html">深入浅出IOC</a></p> <h3 id="_1-2-ioc能做什么"><a href="#_1-2-ioc能做什么" aria-hidden="true" class="header-anchor">#</a> 1.2 IoC能做什么</h3> <p>IoC 不是一种技术，只是一种思想，一个重要的面向对象编程的法则，它能指导我们如何设计出松耦合、更优良的程序。传统应用程序都是由我们在类内部主动创建依赖对象，从而导致类与类之间高耦合，难于测试；有了IoC容器后，把创建和查找依赖对象的控制权交给了容器，由容器进行注入组合对象，所以对象与对象之间是松散耦合，这样也方便测试，利于功能复用，更重要的是使得程序的整个体系结构变得非常灵活。</p> <p>其实IoC对编程带来的最大改变不是从代码上，而是从思想上，发生了“主从换位”的变化。应用程序原本是老大，要获取什么资源都是主动出击，但是在IoC/DI思想中，应用程序就变成被动的了，被动的等待IoC容器来创建并注入它所需要的资源了。</p> <p>IoC很好的体现了面向对象设计法则之一—— 好莱坞法则：“别找我们，我们找你”；即由IoC容器帮对象找相应的依赖对象并注入，而不是由对象主动去找。</p> <h3 id="_1-3-ioc和di"><a href="#_1-3-ioc和di" aria-hidden="true" class="header-anchor">#</a> 1.3 IoC和DI</h3> <p><strong>DI—Dependency Injection，即“依赖注入”</strong>：组件之间依赖关系由容器在运行期决定，形象的说，即由容器动态的将某个依赖关系注入到组件之中。依赖注入的目的并非为软件系统带来更多功能，而是为了提升组件重用的频率，并为系统搭建一个灵活、可扩展的平台。通过依赖注入机制，我们只需要通过简单的配置，而无需任何代码就可指定目标需要的资源，完成自身的业务逻辑，而不需要关心具体的资源来自何处，由谁实现。</p> <p>理解DI的关键是：“<strong>谁依赖谁，为什么需要依赖，谁注入谁，注入了什么</strong>”，那我们来深入分析一下：</p> <ul><li><strong>谁依赖于谁：</strong> 当然是应用程序依赖于IoC容器；</li> <li><strong>为什么需要依赖：</strong> 应用程序需要IoC容器来提供对象需要的外部资源；</li> <li><strong>谁注入谁：</strong> 很明显是IoC容器注入应用程序某个对象，应用程序依赖的对象；</li> <li><strong>注入了什么：</strong> 就是注入某个对象所需要的外部资源（包括对象、资源、常量数据）。</li></ul> <p>IoC和DI由什么关系呢？其实它们是同一个概念的不同角度描述，由于控制反转概念比较含糊（可能只是理解为容器控制对象这一个层面，很难让人想到谁来维护对象关系），所以2004年大师级人物Martin Fowler又给出了一个新的名字：“依赖注入”，相对IoC 而言，<strong>“依赖注入”<strong>明确描述了</strong>“被注入对象依赖IoC容器配置依赖对象”</strong>。</p> <p>对于Spring Ioc这个核心概念，我相信每一个学习Spring的人都会有自己的理解。这种概念上的理解没有绝对的标准答案，仁者见仁智者见智。 理解了IoC和DI的概念后，一切都将变得简单明了，剩下的工作只是在框架中堆积木而已，下一节来看看Spring是怎么用的</p> <h3 id="_1-4-ioc底层原理-降低类之间的耦合度"><a href="#_1-4-ioc底层原理-降低类之间的耦合度" aria-hidden="true" class="header-anchor">#</a> 1.4 IOC底层原理 (降低类之间的耦合度)</h3> <ul><li>底层原理使用技术
<ul><li>xml配置文件</li> <li>dom4j解决xml</li> <li>工厂设计模式</li> <li>反射</li></ul></li> <li>原理</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//伪代码</span>
<span class="token comment">//需要实例化的类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span><span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServlet</span><span class="token punctuation">{</span>
    <span class="token comment">//得到UserService的对象</span>
    <span class="token comment">//原始的做法：new 对象();  来创建</span>
    
    <span class="token comment">//经过spring后</span>
    UserFactory<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//(下面两步的代码调用的)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>第一步：创建xml配置文件，配置要创建的对象类</strong></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.blinkit.UserService<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div><p><strong>第二步：创建工厂类，使用dom4j解析配置文件+反射</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Factory</span> <span class="token punctuation">{</span>
    <span class="token comment">//返回UserService对象的方法</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> UserService <span class="token function">getService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//1.使用dom4j来解析xml文件  </span>
        <span class="token comment">//根据id值userService，得到id值对应的class属性值</span>
        String classValue <span class="token operator">=</span> <span class="token string">&quot;class属性值&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//2.使用反射来创建类对象</span>
        Class <span class="token class-name">clazz</span> <span class="token operator">=</span> Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>classValue<span class="token punctuation">)</span>；
        <span class="token comment">//创建类的对象</span>
        UserService service <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> service<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>超详细原理讲解：<a href="https://github.com/biezhi/java-bible/blob/master/ioc/4.principle.md" target="_blank" rel="noopener noreferrer">java-bible/4.principle.md at master · biezhi/java-bible<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div align="center"><img src="/fullstack-tutorial-site/assets/img/spring-ioc.15810b65.png" width></div><br> <h3 id="_1-5-spring中怎么用"><a href="#_1-5-spring中怎么用" aria-hidden="true" class="header-anchor">#</a> 1.5 Spring中怎么用</h3> <h4 id="（1）配置文件方式"><a href="#（1）配置文件方式" aria-hidden="true" class="header-anchor">#</a> （1）配置文件方式</h4> <p>我们在Spring中是这样获取对象的：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>   
	ApplicationContext context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileSystemXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;applicationContext.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
	Lol lol <span class="token operator">=</span> <span class="token punctuation">(</span>Lol<span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;lol&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
	lol<span class="token punctuation">.</span><span class="token function">gank</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>一起看看Spring如何让它生效呢，在 <code>applicationContext.xml</code> 配置文件中是酱紫的：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>lol<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.biezhi.test.Lol<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>剑圣<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>   
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>  
</code></pre></div><p><code>Lol</code> 类是这样的：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Lol</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> String name<span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token function">Lol</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">gank</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;在gank!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> String <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> name<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面的代码运行结果自然是 <code>剑圣在gank!!</code>。</p> <h4 id="（2）注解方式"><a href="#（2）注解方式" aria-hidden="true" class="header-anchor">#</a> （2）注解方式</h4> <p>Spring更高级的用法，在3.0版本之后有了基于Annotation的注入实现，为毛每次都要配置 <code>Xml</code> 看到都蛋疼。。</p> <p>首先还是要在 <code>xml</code> 中配置启用注解方式</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>annotation-config</span><span class="token punctuation">/&gt;</span></span>  
</code></pre></div><p>这样就能使用注解驱动依赖注入了，下面是一个使用场景</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Lol</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Autowired</span>
	<span class="token keyword">private</span> DuangService duangService <span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buyDuang</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> <span class="token keyword">int</span> money<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		duangService<span class="token punctuation">.</span><span class="token function">buy</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> money<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span><span class="token string">&quot;duangService&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DuangService</span> <span class="token punctuation">{</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buy</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> <span class="token keyword">int</span> money<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>money <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">&quot;买了&quot;</span> <span class="token operator">+</span> money <span class="token operator">+</span> <span class="token string">&quot;毛钱的特效，装逼成功！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token punctuation">{</span>
			System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">&quot;没钱还想装逼，真是匪夷所思&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这只是一个简单的例子，剑圣打野的时候想要买5毛钱的三杀特效，嗯。。虽然不符合逻辑</p> <p>此时 <code>DuangService</code> 已经注入到 <code>Lol</code> 对象中，运行代码的结果（这里是例子，代码不能运行的）就是：</p> <div class="language-java extra-class"><pre class="language-java"><code>德玛买了<span class="token number">5</span>毛钱的特效，装逼成功！
</code></pre></div><h2 id="_2-di（依赖注入）"><a href="#_2-di（依赖注入）" aria-hidden="true" class="header-anchor">#</a> 2. DI（依赖注入）</h2> <h3 id="_2-1-什么是依赖注入"><a href="#_2-1-什么是依赖注入" aria-hidden="true" class="header-anchor">#</a> 2.1 什么是依赖注入</h3> <p>在依赖注入的模式下，创建被调用者得工作不再由调用者来完成，创建被调用者实例的工作通常由Spring容器完成，然后注入调用者。<strong>创建对象时，向类里的属性设置值</strong></p> <h3 id="_2-2-为什么使用依赖注入"><a href="#_2-2-为什么使用依赖注入" aria-hidden="true" class="header-anchor">#</a> 2.2 为什么使用依赖注入</h3> <p>为了实现代码/模块之间松耦合。</p> <h3 id="_2-3-为什么要实现松耦合"><a href="#_2-3-为什么要实现松耦合" aria-hidden="true" class="header-anchor">#</a> 2.3 为什么要实现松耦合</h3> <p>上层调用下层，上层依赖于下层，当下层剧烈变动时上层也要跟着变动，这就会导致模块的复用性降低而且大大提高了开发的成本。</p> <p>一般情况下抽象的变化概率很小，让用户程序依赖于抽象，实现的细节也依赖于抽象。即使实现细节不断变动，只要抽象不变，客户程序就不需要变化。这大大降低了客户程序与实现细节的耦合度。</p> <h3 id="_2-4-ioc和di区别"><a href="#_2-4-ioc和di区别" aria-hidden="true" class="header-anchor">#</a> 2.4 IOC和DI区别</h3> <ol><li>IOC控制反转，把对象创建交给Spring配置</li> <li>DI依赖注入，向类里面属性注入值</li> <li>关系，依赖注入不能单独存在，需要在IOC基础上完成操作</li></ol> <h3 id="_2-5-依赖注入方式"><a href="#_2-5-依赖注入方式" aria-hidden="true" class="header-anchor">#</a> 2.5 依赖注入方式</h3> <ol><li><p>使用set方法注入</p></li> <li><p>使用有参构造注入</p></li> <li><p>使用接口注入</p></li></ol> <p>说明：Spring框架中支持前两种方式</p> <h4 id="（1）使用set方法注入"><a href="#（1）使用set方法注入" aria-hidden="true" class="header-anchor">#</a> （1）使用set方法注入</h4> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>person<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.wang.property.Person<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--set方法注入属性
    name属性值：类中定义的属性名称
    value属性值：设置具体的值
--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>pname<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>zs<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>1234567
</code></pre></div><h4 id="（2）使用有参构造注入"><a href="#（2）使用有参构造注入" aria-hidden="true" class="header-anchor">#</a> （2）使用有参构造注入</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String pname<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPname</span><span class="token punctuation">(</span>String pname<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pname <span class="token operator">=</span> pname<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.wang.ioc.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--构造方法注入属性--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>pname<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Tony<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>constructor-arg</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="（3）注入对象类型属性"><a href="#（3）注入对象类型属性" aria-hidden="true" class="header-anchor">#</a> （3）注入对象类型属性</h4> <ul><li>创建service和dao类，在service中得到dao</li></ul> <p>具体实现过程</p> <ul><li>在service中把dao作为属性，生成dao的set方法</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.定义UserDao类型属性</span>
    <span class="token keyword">private</span> UserDao userDao<span class="token punctuation">;</span>

    <span class="token comment">// 2.生成set方法</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUserDao</span><span class="token punctuation">(</span>UserDao userDao<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userDao <span class="token operator">=</span> userDao<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>配置文件注入关系</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;userDao&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;cn.wang.property.UserDao&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;name&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;Tom&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;userService&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;cn.wang.property.UserService&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>name属性值：UserService类里的属性名称<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>ref属性<span class="token operator">:</span>UserDao类配置bean标签中的id值<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;userDao&quot;</span> ref<span class="token operator">=</span><span class="token string">&quot;userDao&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span><span class="token number">12345678</span>
</code></pre></div><h4 id="（4）p名称空间注入"><a href="#（4）p名称空间注入" aria-hidden="true" class="header-anchor">#</a> （4）p名称空间注入</h4> <p><img src="/fullstack-tutorial-site/assets/img/ioc-p1.fb6c6595.png" alt="p名称空间注入"></p> <p><img src="/fullstack-tutorial-site/assets/img/ioc-p2.4aceaa6a.png" alt="p名称空间注入"></p> <h4 id="（5）注入复杂类型属性"><a href="#（5）注入复杂类型属性" aria-hidden="true" class="header-anchor">#</a> （5）注入复杂类型属性</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 注入复杂类型属性值 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 
    String pname<span class="token punctuation">;</span>
    String<span class="token punctuation">[</span><span class="token punctuation">]</span> arrs<span class="token punctuation">;</span>
    List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> list<span class="token punctuation">;</span>
    Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span></span> map<span class="token punctuation">;</span>
    Properties props<span class="token punctuation">;</span> 
    <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">&quot;person&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;cn.wang.property.Person&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;pname&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;zs&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;arrs&quot;</span><span class="token operator">&gt;</span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>list<span class="token punctuation">&gt;</span></span>
                <span class="token generics function"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>aaa<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
                <span class="token generics function"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>bbb<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
                <span class="token generics function"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>ccc<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>list<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;list&quot;</span><span class="token operator">&gt;</span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>list<span class="token punctuation">&gt;</span></span>
                <span class="token generics function"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>qqq<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
                <span class="token generics function"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>www<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
                <span class="token generics function"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>eee<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>list<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;map&quot;</span><span class="token operator">&gt;</span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>map<span class="token punctuation">&gt;</span></span>
                <span class="token operator">&lt;</span>entry key<span class="token operator">=</span><span class="token string">&quot;001&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;Tom&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>entry<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>entry key<span class="token operator">=</span><span class="token string">&quot;002&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;Amy&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>entry<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>entry key<span class="token operator">=</span><span class="token string">&quot;003&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;Jim&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>entry<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>map<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">&quot;props&quot;</span><span class="token operator">&gt;</span>
            <span class="token generics function"><span class="token punctuation">&lt;</span>props<span class="token punctuation">&gt;</span></span>
                <span class="token operator">&lt;</span>prop key<span class="token operator">=</span><span class="token string">&quot;username&quot;</span><span class="token operator">&gt;</span>admin<span class="token operator">&lt;</span><span class="token operator">/</span>prop<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>prop key<span class="token operator">=</span><span class="token string">&quot;passwprd&quot;</span><span class="token operator">&gt;</span>admin<span class="token operator">&lt;</span><span class="token operator">/</span>prop<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>props<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">&gt;</span>
</code></pre></div><h2 id="_3-aop（面向切面编程）"><a href="#_3-aop（面向切面编程）" aria-hidden="true" class="header-anchor">#</a> 3. AOP（面向切面编程）</h2> <div align="center"><img src="/fullstack-tutorial-site/assets/img/spring-aop.c7951d66.png" width="650"></div><br> <h3 id="_3-1-什么是aop"><a href="#_3-1-什么是aop" aria-hidden="true" class="header-anchor">#</a> 3.1 什么是AOP</h3> <p>AOP（Aspect Oriented Programming ）称为面向切面编程，扩展功能不是修改源代码实现，在程序开发中主要用来解决一些系统层面上的问题，比如日志，事务，权限等待，Struts2的拦截器设计就是基于AOP的思想，是个比较经典的例子。</p> <ul><li>AOP：面向切面编程，扩展功能不修改源代码实现</li> <li>AOP采取<strong>横向抽取机制</strong>，取代了传统<strong>纵向继承</strong>体系重复性代码（性能监视、事务管理、安全检查、缓存）</li></ul> <p><strong>spring的底层采用两种方式进行增强</strong></p> <pre><code>     第一：Spring传统AOP 纯java实现，在运行期，对目标对象进行代理，织入增强代码

     第二：AspectJ第三方开源技术，Spring已经整合AspectJ，提供对AspectJ注解的支持，开发AOP程序 更加容易（企业主流）
</code></pre> <h3 id="_3-2-底层原理"><a href="#_3-2-底层原理" aria-hidden="true" class="header-anchor">#</a> 3.2 底层原理</h3> <div align="center"><img src="/fullstack-tutorial-site/assets/img/aop2.7458542f.png" width="650"></div><br> <h4 id="第一种-jdk-自带的动态代理技术"><a href="#第一种-jdk-自带的动态代理技术" aria-hidden="true" class="header-anchor">#</a> 第一种 JDK 自带的动态代理技术</h4> <p>JDK动态代理必须基于接口进行代理</p> <p>作用：使用代理可以对目标对象进行性能监控（计算运行时间）、安全检查（是否具有权限）、 记录日志等。</p> <p>注意：必须要有接口才能进行代理，代理后对象必须转换为接口类型</p> <h4 id="第二种-cglib-codegenerationlibrary-是一个开源项目"><a href="#第二种-cglib-codegenerationlibrary-是一个开源项目" aria-hidden="true" class="header-anchor">#</a> 第二种 CGLIB(CodeGenerationLibrary)是一个开源项目</h4> <p>Spring使用CGlib 进行AOP代理， hibernate 也是支持CGlib（默认使用 javassist ）需要下载cglib 的jar包（Spring 最新版本3.2 内部已经集成了cglib ，<strong>无需下载cglib的jar</strong> ）</p> <p><strong>作用：可以为目标类，动态创建子类，对目标类方法进行代理（无需接口）</strong></p> <p>原理：Spring AOP 底层，会判断用户是根据接口代理还是目标类代理，如果针对接口代理就使用JDK代理，如果针对目标类代理就使用Cglib代理。</p> <div align="center"><img src="/fullstack-tutorial-site/assets/img/aop1.184fad57.png" width="650"></div><br> <h3 id="_3-3-aop操作术语"><a href="#_3-3-aop操作术语" aria-hidden="true" class="header-anchor">#</a> 3.3 AOP操作术语</h3> <p>以下面代码为例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p><strong>Joinpoint（连接点）（重要）</strong></p> <ul><li>类里面可以被增强的方法，这些方法称为连接点</li></ul></li> <li><p><strong>Pointcut（切入点）（重要）</strong></p> <ul><li>所谓切入点是指我们要对哪些 Joinpoint  进行拦截的定义</li></ul></li> <li><p><strong>Advice（通知/增强）（重要）</strong></p> <ul><li>所谓通知是指拦截到 Joinpoint 之后所要做的事情就是通知。通知分为<strong>前置通知，后置通知，异常通知，最终通知，环绕通知</strong>（方法之前和方法之后）</li></ul></li> <li><p><strong>Aspect（切面）</strong>：</p> <ul><li>把增强应用到具体方法上面，过程成为切面。</li></ul></li> <li><p><strong>Introduction（引介）</strong></p> <ul><li>引介是一种特殊的通知在不修改类代码的前提下， Introduction 可以在运行期为类动态地添加一些方法或 Field。</li></ul></li> <li><p><strong>Target（目标对象）</strong></p> <ul><li>代理的目标对象（要增强的类）</li></ul></li> <li><p><strong>Weaving（织入）</strong></p> <ul><li>是把增强应用到目标的过程，把 advice 应用到 target的过程</li></ul></li> <li><p><strong>Proxy（代理）</strong></p> <ul><li>一个类被 AOP 织入增强后，就产生一个结果代理类</li></ul></li></ul> <h3 id="_3-4-spring的aop操作"><a href="#_3-4-spring的aop操作" aria-hidden="true" class="header-anchor">#</a> 3.4 Spring的AOP操作</h3> <ul><li><p>在Spring里面进行Aop操作，使用aspectj实现</p> <ul><li>aspectj不是Spring的一部分，和Spring一起使用进行Aop操作</li> <li>Spring2.0以后新增了对aspectj的支持</li></ul></li> <li><p>使用aspectj实现aop有两种方式</p> <ul><li>基于aspectj的xml配置</li> <li>基于aspectj的注解方式</li></ul></li></ul> <h4 id="（1）aop准备操作"><a href="#（1）aop准备操作" aria-hidden="true" class="header-anchor">#</a> （1）AOP准备操作</h4> <p>1、除了导入基本的jar包之外，还需要导入aop相关的jar包：</p> <div class="language- extra-class"><pre class="language-text"><code>aopalliance-1.0.jar
aspectjweaver-1.8.7.jar
spring-aspects-5.0.4.RELEASE.jar
spring-aop-5.0.4.RELEASE.jar
</code></pre></div><p>2、创建Spring核心配置文件
除了引入了约束spring-beans之外还需要引入新约束spring-aop</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-aop.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>12345678
</code></pre></div><h4 id="（2）使用表达式配置切入点"><a href="#（2）使用表达式配置切入点" aria-hidden="true" class="header-anchor">#</a> （2）使用表达式配置切入点</h4> <ol><li>切入点：实际增强的方法</li> <li>常用的表达式
execution(&lt;访问修饰符&gt;? &lt;返回类型&gt; &lt;方法名&gt;(&lt;参数&gt;)&lt;异常&gt;)
（1）对包内的add方法进行增强
<code>execution(* cn.blinkit.aop.Book.add(..))</code>
（2）* 是对类里面的所有方法进行增强
<code>execution(* cn.blinkit.aop.Book.*(..))</code>
（3）<em>.</em> 是所有的类中的方法进行增强
<code>execution(* *.*(..))</code>
（4）匹配所有save开头的方法
<code>execution(* save*(..))</code></li></ol> <h3 id="_3-5-使用xml实现aop"><a href="#_3-5-使用xml实现aop" aria-hidden="true" class="header-anchor">#</a> 3.5 使用xml实现AOP</h3> <p><strong>aop配置代码：</strong> Book</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;add......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>MyBook</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBook</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;前置增强......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;后置增强......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//环绕通知</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">around1</span><span class="token punctuation">(</span>ProceedingJoinPoint proceedingJoinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{</span>
        <span class="token comment">//方法之前</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;方法之前.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//执行被增强的方法</span>
        proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//方法之后</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;方法之后......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>xml配置</p> <div class="language-xml extra-class"><pre class="language-xml"><code>    <span class="token comment">&lt;!--1. 配置对象--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>book<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.blinkit.aop.Book<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myBook<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.blinkit.aop.MyBook<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--2. 配置aop操作--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--2.1 配置切入点--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>pointcut</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>pointcut1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>execution(* cn.blinkit.aop.Book.*(..))<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>pointcut</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--2.2 配置切面
                把增强用到方法上面
        --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspect</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myBook<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--
                aop:before   :前置通知
                aop:after    :后置通知
                aop:around   :环绕通知
                配置增强类型
                method : 增强类里面使用哪个方法作为前置
            --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>before</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>before1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>pointcut1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>before</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>after</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>after1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>pointcut1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>after</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>around</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>around1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>pointcut1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>around</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>aspect</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>测试代码</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AOPTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testBook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ApplicationContext context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;cn/blinkit/aop/spring-aop.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Book book <span class="token operator">=</span> <span class="token punctuation">(</span>Book<span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;book&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        book<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-6-使用注解实现aop"><a href="#_3-6-使用注解实现aop" aria-hidden="true" class="header-anchor">#</a> 3.6 使用注解实现AOP</h3> <ol><li><p>创建对象
(1)创建Book和MyBook <strong>（增强类）</strong> 对象</p></li> <li><p>在spring核心配置文件中，开启aop操作
具体操作见xml配置文件代码：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>aop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/aop<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- 1.开启aop操作 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspectj-autoproxy</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>aspectj-autoproxy</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- 2.配置对象 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>book<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.jxs.aspectj.Book<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>nbBook<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.jxs.aspectj.NBBook<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>在增强类上面使用注解完成aop操作
（1）类上面加上<code>@Aspect</code>
（2）方法上面加上
<code>@Before(value = &quot;execution(* cn.blinkit.aop.anno.Book.*(..))&quot;)</code> <code>@After(value = &quot;表达式&quot;)</code> <code>@Around(value = &quot;表达式&quot;)</code>等...</p></li> <li></li></ol> <p><strong>Book</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;add...注解版本...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>MyBook增强类</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBook</span> <span class="token punctuation">{</span>
    <span class="token comment">//在方法上面使用注解完成增强配置</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;execution(* cn.blinkit.aop.anno.Book.*(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;前置增强...注解版本...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;execution(* cn.blinkit.aop.anno.Book.*(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;后置增强...注解版本...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//环绕通知</span>
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;execution(* cn.blinkit.aop.anno.Book.*(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">around1</span><span class="token punctuation">(</span>ProceedingJoinPoint proceedingJoinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{</span>
        <span class="token comment">//方法之前</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;方法之前...注解版本...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//执行被增强的方法</span>
        proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//方法之后</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;方法之后...注解版本...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>xml配置</strong></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!--开启aop操作--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspectj-autoproxy</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>aspectj-autoproxy</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--创建对象--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>book<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.blinkit.aop.anno.Book<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myBook<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cn.blinkit.aop.anno.MyBook<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_3-7-为什么需要代理模式？"><a href="#_3-7-为什么需要代理模式？" aria-hidden="true" class="header-anchor">#</a> 3.7 为什么需要代理模式？</h3> <p>假设需实现一个计算的类Math、完成加、减、乘、除功能，如下所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>zhangguo<span class="token punctuation">.</span>Spring041<span class="token punctuation">.</span>aop01<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Math</span> <span class="token punctuation">{</span>
    <span class="token comment">//加</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span><span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">int</span> result<span class="token operator">=</span>n1<span class="token operator">+</span>n2<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n1<span class="token operator">+</span><span class="token string">&quot;+&quot;</span><span class="token operator">+</span>n2<span class="token operator">+</span><span class="token string">&quot;=&quot;</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    
    <span class="token comment">//减</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span><span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">int</span> result<span class="token operator">=</span>n1<span class="token operator">-</span>n2<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n1<span class="token operator">+</span><span class="token string">&quot;-&quot;</span><span class="token operator">+</span>n2<span class="token operator">+</span><span class="token string">&quot;=&quot;</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//乘</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">mut</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span><span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">int</span> result<span class="token operator">=</span>n1<span class="token operator">*</span>n2<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n1<span class="token operator">+</span><span class="token string">&quot;X&quot;</span><span class="token operator">+</span>n2<span class="token operator">+</span><span class="token string">&quot;=&quot;</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//除</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">div</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span><span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">int</span> result<span class="token operator">=</span>n1<span class="token operator">/</span>n2<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n1<span class="token operator">+</span><span class="token string">&quot;/&quot;</span><span class="token operator">+</span>n2<span class="token operator">+</span><span class="token string">&quot;=&quot;</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>现在需求发生了变化，要求项目中所有的类在执行方法时输出执行耗时。最直接的办法是修改源代码，如下所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>zhangguo<span class="token punctuation">.</span>Spring041<span class="token punctuation">.</span>aop01<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Random<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Math</span> <span class="token punctuation">{</span>
    <span class="token comment">//加</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span><span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//开始时间</span>
        <span class="token keyword">long</span> start<span class="token operator">=</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> result<span class="token operator">=</span>n1<span class="token operator">+</span>n2<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n1<span class="token operator">+</span><span class="token string">&quot;+&quot;</span><span class="token operator">+</span>n2<span class="token operator">+</span><span class="token string">&quot;=&quot;</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Long span<span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>start<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;共用时：&quot;</span><span class="token operator">+</span>span<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//减</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span><span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//开始时间</span>
        <span class="token keyword">long</span> start<span class="token operator">=</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> result<span class="token operator">=</span>n1<span class="token operator">-</span>n2<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n1<span class="token operator">+</span><span class="token string">&quot;-&quot;</span><span class="token operator">+</span>n2<span class="token operator">+</span><span class="token string">&quot;=&quot;</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Long span<span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>start<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;共用时：&quot;</span><span class="token operator">+</span>span<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//乘</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">mut</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span><span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//开始时间</span>
        <span class="token keyword">long</span> start<span class="token operator">=</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> result<span class="token operator">=</span>n1<span class="token operator">*</span>n2<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n1<span class="token operator">+</span><span class="token string">&quot;X&quot;</span><span class="token operator">+</span>n2<span class="token operator">+</span><span class="token string">&quot;=&quot;</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Long span<span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>start<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;共用时：&quot;</span><span class="token operator">+</span>span<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//除</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">div</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span><span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//开始时间</span>
        <span class="token keyword">long</span> start<span class="token operator">=</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> result<span class="token operator">=</span>n1<span class="token operator">/</span>n2<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n1<span class="token operator">+</span><span class="token string">&quot;/&quot;</span><span class="token operator">+</span>n2<span class="token operator">+</span><span class="token string">&quot;=&quot;</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Long span<span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>start<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;共用时：&quot;</span><span class="token operator">+</span>span<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//模拟延时</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> n<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>缺点：</p> <ol><li>工作量特别大，如果项目中有多个类，多个方法，则要修改多次。</li> <li>违背了设计原则：开闭原则（OCP），对扩展开放，对修改关闭，而为了增加功能把每个方法都修改了，也不便于维护。</li> <li>违背了设计原则：单一职责（SRP），每个方法除了要完成自己本身的功能，还要计算耗时、延时；每一个方法引起它变化的原因就有多种。</li> <li>违背了设计原则：依赖倒转（DIP），抽象不应该依赖细节，两者都应该依赖抽象。而在Test类中，Test与Math都是细节。</li></ol> <p>解决：</p> <ul><li>使用静态代理可以解决部分问题（请往下看...）</li></ul> <h3 id="_3-8-静态代理"><a href="#_3-8-静态代理" aria-hidden="true" class="header-anchor">#</a> 3.8 静态代理</h3> <p>1、定义抽象主题接口</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>zhangguo<span class="token punctuation">.</span>Spring041<span class="token punctuation">.</span>aop02<span class="token punctuation">;</span>

<span class="token comment">/**
 * 接口
 * 抽象主题
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IMath</span> <span class="token punctuation">{</span>
    <span class="token comment">//加</span>
    <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span> <span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//减</span>
    <span class="token keyword">int</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span> <span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//乘</span>
    <span class="token keyword">int</span> <span class="token function">mut</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span> <span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//除</span>
    <span class="token keyword">int</span> <span class="token function">div</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span> <span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>2、主题类，算术类，实现抽象接口</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>zhangguo<span class="token punctuation">.</span>Spring041<span class="token punctuation">.</span>aop02<span class="token punctuation">;</span>

<span class="token comment">/**
 * 被代理的目标对象
 *真实主题
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Math</span> <span class="token keyword">implements</span> <span class="token class-name">IMath</span> <span class="token punctuation">{</span>
    <span class="token comment">//加</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span><span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">int</span> result<span class="token operator">=</span>n1<span class="token operator">+</span>n2<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n1<span class="token operator">+</span><span class="token string">&quot;+&quot;</span><span class="token operator">+</span>n2<span class="token operator">+</span><span class="token string">&quot;=&quot;</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//减</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span><span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">int</span> result<span class="token operator">=</span>n1<span class="token operator">-</span>n2<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n1<span class="token operator">+</span><span class="token string">&quot;-&quot;</span><span class="token operator">+</span>n2<span class="token operator">+</span><span class="token string">&quot;=&quot;</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//乘</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">mut</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span><span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">int</span> result<span class="token operator">=</span>n1<span class="token operator">*</span>n2<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n1<span class="token operator">+</span><span class="token string">&quot;X&quot;</span><span class="token operator">+</span>n2<span class="token operator">+</span><span class="token string">&quot;=&quot;</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//除</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">div</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span><span class="token keyword">int</span> n2<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">int</span> result<span class="token operator">=</span>n1<span class="token operator">/</span>n2<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n1<span class="token operator">+</span><span class="token string">&quot;/&quot;</span><span class="token operator">+</span>n2<span class="token operator">+</span><span class="token string">&quot;=&quot;</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>3、代理类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>zhangguo<span class="token punctuation">.</span>Spring041<span class="token punctuation">.</span>aop02<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Random<span class="token punctuation">;</span>

<span class="token comment">/**
 * 静态代理类
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MathProxy</span> <span class="token keyword">implements</span> <span class="token class-name">IMath</span> <span class="token punctuation">{</span>

    <span class="token comment">//被代理的对象</span>
    IMath math<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Math</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//加</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span> <span class="token keyword">int</span> n2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//开始时间</span>
        <span class="token keyword">long</span> start<span class="token operator">=</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> result<span class="token operator">=</span>math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Long span<span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>start<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;共用时：&quot;</span><span class="token operator">+</span>span<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//减法</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span> <span class="token keyword">int</span> n2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//开始时间</span>
        <span class="token keyword">long</span> start<span class="token operator">=</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> result<span class="token operator">=</span>math<span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Long span<span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>start<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;共用时：&quot;</span><span class="token operator">+</span>span<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//乘</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">mut</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span> <span class="token keyword">int</span> n2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//开始时间</span>
        <span class="token keyword">long</span> start<span class="token operator">=</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> result<span class="token operator">=</span>math<span class="token punctuation">.</span><span class="token function">mut</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Long span<span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>start<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;共用时：&quot;</span><span class="token operator">+</span>span<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//除</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">div</span><span class="token punctuation">(</span><span class="token keyword">int</span> n1<span class="token punctuation">,</span> <span class="token keyword">int</span> n2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//开始时间</span>
        <span class="token keyword">long</span> start<span class="token operator">=</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> result<span class="token operator">=</span>math<span class="token punctuation">.</span><span class="token function">div</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Long span<span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>start<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;共用时：&quot;</span><span class="token operator">+</span>span<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//模拟延时</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> n<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>4、测试运行</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>zhangguo<span class="token punctuation">.</span>Spring041<span class="token punctuation">.</span>aop02<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    
    IMath math<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">MathProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@org</span><span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">int</span> n1<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>n2<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>
        math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        math<span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        math<span class="token punctuation">.</span><span class="token function">mut</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        math<span class="token punctuation">.</span><span class="token function">div</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>5、小结</p> <p>通过静态代理，是否完全解决了上述的4个问题：</p> <p><strong>已解决：</strong></p> <ul><li><p>解决了“开闭原则（OCP）”的问题，因为并没有修改Math类，而扩展出了MathProxy类。</p></li> <li><p>解决了“依赖倒转（DIP）”的问题，通过引入接口。</p></li> <li><p>解决了“单一职责（SRP）”的问题，Math类不再需要去计算耗时与延时操作，但从某些方面讲MathProxy还是存在该问题。</p></li></ul> <p><strong>未解决：</strong></p> <ul><li>如果项目中有多个类，则需要编写多个代理类，工作量大，不好修改，不好维护，不能应对变化。</li></ul> <p>如果要解决上面的问题，可以使用动态代理。</p> <h3 id="_3-9-动态代理，使用jdk内置的proxy实现"><a href="#_3-9-动态代理，使用jdk内置的proxy实现" aria-hidden="true" class="header-anchor">#</a> 3.9 动态代理，使用JDK内置的Proxy实现</h3> <p>只需要一个代理类，而不是针对每个类编写代理类。</p> <p>在上一个示例中修改代理类MathProxy如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>zhangguo<span class="token punctuation">.</span>Spring041<span class="token punctuation">.</span>aop03<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>InvocationHandler<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Method<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Proxy<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Random<span class="token punctuation">;</span>

<span class="token comment">/**
 * 动态代理类
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicProxy</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>

    <span class="token comment">//被代理的对象</span>
    Object targetObject<span class="token punctuation">;</span>
    
    <span class="token comment">/**
     * 获得被代理后的对象
     * @param object 被代理的对象
     * @return 代理后的对象
     */</span>
    <span class="token keyword">public</span> Object <span class="token function">getProxyObject</span><span class="token punctuation">(</span>Object object<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>targetObject<span class="token operator">=</span>object<span class="token punctuation">;</span>
        <span class="token keyword">return</span> Proxy<span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>
                targetObject<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//类加载器</span>
                targetObject<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">//获得被代理对象的所有接口</span>
                <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//InvocationHandler对象</span>
        <span class="token comment">//loader:一个ClassLoader对象，定义了由哪个ClassLoader对象来生成代理对象进行加载</span>
        <span class="token comment">//interfaces:一个Interface对象的数组，表示的是我将要给我需要代理的对象提供一组什么接口，如果我提供了一组接口给它，那么这个代理对象就宣称实现了该接口(多态)，这样我就能调用这组接口中的方法了</span>
        <span class="token comment">//h:一个InvocationHandler对象，表示的是当我这个动态代理对象在调用方法的时候，会关联到哪一个InvocationHandler对象上，间接通过invoke来执行</span>
    <span class="token punctuation">}</span>
    
    
    <span class="token comment">/**
     * 当用户调用对象中的每个方法时都通过下面的方法执行，方法必须在接口
     * proxy 被代理后的对象
     * method 将要被执行的方法信息（反射）
     * args 执行方法时需要的参数
     */</span>
    <span class="token keyword">public</span> Object <span class="token function">invoke</span><span class="token punctuation">(</span>Object proxy<span class="token punctuation">,</span> Method method<span class="token punctuation">,</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{</span>
        <span class="token comment">//被织入的内容，开始时间</span>
        <span class="token keyword">long</span> start<span class="token operator">=</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//使用反射在目标对象上调用方法并传入参数</span>
        Object result<span class="token operator">=</span>method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>targetObject<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//被织入的内容，结束时间</span>
        Long span<span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>start<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;共用时：&quot;</span><span class="token operator">+</span>span<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//模拟延时</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> n<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>测试运行：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>zhangguo<span class="token punctuation">.</span>Spring041<span class="token punctuation">.</span>aop03<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    
    <span class="token comment">//实例化一个MathProxy代理对象</span>
    <span class="token comment">//通过getProxyObject方法获得被代理后的对象</span>
    IMath math<span class="token operator">=</span><span class="token punctuation">(</span>IMath<span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">DynamicProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProxyObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Math</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@org</span><span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">int</span> n1<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>n2<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>
        math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        math<span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        math<span class="token punctuation">.</span><span class="token function">mut</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        math<span class="token punctuation">.</span><span class="token function">div</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    IMessage message<span class="token operator">=</span><span class="token punctuation">(</span>IMessage<span class="token punctuation">)</span> <span class="token keyword">new</span> <span class="token class-name">DynamicProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProxyObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@org</span><span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        message<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>小结：</p> <p>JDK内置的Proxy动态代理可以在运行时动态生成字节码，而没必要针对每个类编写代理类。中间主要使用到了一个接口InvocationHandler与Proxy.newProxyInstance静态方法，参数说明如下：</p> <p>使用内置的Proxy实现动态代理有一个问题：<strong>被代理的类必须实现接口，未实现接口则没办法完成动态代理。</strong></p> <p>如果项目中有些类没有实现接口，则不应该为了实现动态代理而刻意去抽出一些没有实例意义的接口，通过cglib可以解决该问题。</p> <h3 id="_3-10-动态代理，使用cglib实现"><a href="#_3-10-动态代理，使用cglib实现" aria-hidden="true" class="header-anchor">#</a> 3.10 动态代理，使用cglib实现</h3> <p>CGLIB(Code Generation Library)是一个开源项目,是一个强大的，高性能，高质量的Code生成类库，它可以在运行期扩展Java类与实现Java接口，通俗说cglib可以在运行时动态生成字节码。</p> <p>1、引用cglib，通过maven</p> <p>2、使用cglib完成动态代理，大概的原理是：cglib继承被代理的类，重写方法，织入通知，动态生成字节码并运行，因为是继承所以final类是没有办法动态代理的。具体实现如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>zhangguo<span class="token punctuation">.</span>Spring041<span class="token punctuation">.</span>aop04<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Method<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Random<span class="token punctuation">;</span>

<span class="token keyword">import</span> net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>Enhancer<span class="token punctuation">;</span>
<span class="token keyword">import</span> net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>MethodInterceptor<span class="token punctuation">;</span>
<span class="token keyword">import</span> net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>MethodProxy<span class="token punctuation">;</span>

<span class="token comment">/*
 * 动态代理类
 * 实现了一个方法拦截器接口
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicProxy</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">{</span>

    <span class="token comment">// 被代理对象</span>
    Object targetObject<span class="token punctuation">;</span>

    <span class="token comment">//Generate a new class if necessary and uses the specified callbacks (if any) to create a new object instance. </span>
    <span class="token comment">//Uses the no-arg constructor of the superclass.</span>
    <span class="token comment">//动态生成一个新的类，使用父类的无参构造方法创建一个指定了特定回调的代理实例</span>
    <span class="token keyword">public</span> Object <span class="token function">getProxyObject</span><span class="token punctuation">(</span>Object object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>targetObject <span class="token operator">=</span> object<span class="token punctuation">;</span>
        <span class="token comment">//增强器，动态代码生成器</span>
        Enhancer enhancer<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//回调方法</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置生成类的父类类型</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span>targetObject<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//动态生成字节码并返回代理对象</span>
        <span class="token keyword">return</span> enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 拦截方法</span>
    <span class="token keyword">public</span> Object <span class="token function">intercept</span><span class="token punctuation">(</span>Object object<span class="token punctuation">,</span> Method method<span class="token punctuation">,</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> MethodProxy methodProxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> Throwable <span class="token punctuation">{</span>
        <span class="token comment">// 被织入的横切内容，开始时间 before</span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 调用方法</span>
        Object result <span class="token operator">=</span> methodProxy<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>targetObject<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 被织入的横切内容，结束时间</span>
        Long span <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;共用时：&quot;</span> <span class="token operator">+</span> span<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 模拟延时</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>测试运行：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> com<span class="token punctuation">.</span>zhangguo<span class="token punctuation">.</span>Spring041<span class="token punctuation">.</span>aop04<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token comment">//实例化一个DynamicProxy代理对象</span>
    <span class="token comment">//通过getProxyObject方法获得被代理后的对象</span>
    Math math<span class="token operator">=</span><span class="token punctuation">(</span>Math<span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">DynamicProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProxyObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Math</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@org</span><span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">int</span> n1<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>n2<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>
        math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        math<span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        math<span class="token punctuation">.</span><span class="token function">mut</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        math<span class="token punctuation">.</span><span class="token function">div</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//另一个被代理的对象,不再需要重新编辑代理代码</span>
    Message message<span class="token operator">=</span><span class="token punctuation">(</span>Message<span class="token punctuation">)</span> <span class="token keyword">new</span> <span class="token class-name">DynamicProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProxyObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@org</span><span class="token punctuation">.</span>junit<span class="token punctuation">.</span>Test
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test02</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        message<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>小结</strong></p> <p>使用cglib可以实现动态代理，即使被代理的类没有实现接口，但被代理的类必须不是final类。</p> <h2 id="_4-spring-ioc容器"><a href="#_4-spring-ioc容器" aria-hidden="true" class="header-anchor">#</a> 4. Spring Ioc容器</h2> <h3 id="_4-1-bean作用域"><a href="#_4-1-bean作用域" aria-hidden="true" class="header-anchor">#</a> 4.1 Bean作用域</h3> <p>Spring 框架支持以下五个作用域，如果你使用 web-aware ApplicationContext 时，其中三个是可用的。</p> <table><thead><tr><th>作用域</th> <th>描述</th></tr></thead> <tbody><tr><td>singleton</td> <td>在spring IoC容器仅存在一个Bean实例，Bean以单例方式存在，默认值</td></tr> <tr><td>prototype</td> <td>每次从容器中调用Bean时，都返回一个新的实例，即每次调用getBean()时，相当于执行newXxxBean()</td></tr> <tr><td>request</td> <td>每次HTTP请求都会创建一个新的Bean，该作用域仅适用于WebApplicationContext环境</td></tr> <tr><td>session</td> <td>同一个HTTP Session共享一个Bean，不同Session使用不同的Bean，仅适用于WebApplicationContext环境</td></tr> <tr><td>global-session</td> <td>一般用于Portlet应用环境，改作用于仅适用于WebApplicationContext环境</td></tr></tbody></table> <h3 id="_4-2-bean-的生命周期"><a href="#_4-2-bean-的生命周期" aria-hidden="true" class="header-anchor">#</a> 4.2 Bean 的生命周期</h3> <p>在传统的Java应用中，bean的生命周期很简单。使用Java关键字new进行bean实例化，然后该bean就可以使用了。一旦该bean不再被使用，则由Java自动进行垃圾回收。</p> <p>相比之下，Spring容器中的bean的生命周期就显得相对复杂多了。正确理解Spring bean的生命周期非常重要，因为你或许要利用Spring提供的扩展点来自定义bean的创建过程。下图展示了bean装载到Spring应用上下文中的一个典型的生命周期过程。</p> <div align="center"><img src="/fullstack-tutorial-site/assets/img/bean-life.754a34e0.png" width></div><br> <p>上图bean在Spring容器中从创建到销毁经历了若干阶段，每一阶段都可以针对Spring如何管理bean进行个性化定制</p> <p><strong>正如你所见，在bean准备就绪之前，bean工厂执行了若干启动步骤。我们对上图进行详细描述：</strong></p> <ol><li><p>Spring 对 Bean 进行实例化；</p> <ul><li>相当于程序中的new Xx()</li></ul></li> <li><p>Spring 将值和 Bean 的引用注入进 Bean 对应的属性中；</p></li> <li><p><strong>如果Bean实现了 BeanNameAware 接口</strong>，Spring 将 Bean 的 ID 传递给setBeanName()方法</p> <ul><li>实现BeanNameAware清主要是为了通过Bean的引用来获得Bean的ID，一般业务中是很少有在Bean的ID的</li></ul></li> <li><p><strong>如果Bean实现了BeanFactoryAware接口</strong>，Spring将调用setBeanDactory(BeanFactory bf)方法并把BeanFactory容器实例作为参数传入。</p> <ul><li>实现BeanFactoryAware 主要目的是为了获取Spring容器，如Bean通过Spring容器发布事件等</li></ul></li> <li><p><strong>如果Bean实现了ApplicationContextAwaer接口</strong>，Spring容器将调用setApplicationContext(ApplicationContext ctx)方法，将bean所在的应用上下文的引用传入进来</p> <ul><li>作用与BeanFactory类似都是为了获取Spring容器，不同的是Spring容器在调用setApplicationContext方法时会把它自己作为setApplicationContext 的参数传入，而Spring容器在调用setBeanDactory前需要程序员自己指定（注入）setBeanDactory里的参数BeanFactory</li></ul></li> <li><p><strong>如果Bean实现了BeanPostProcess接口</strong>，Spring将调用它们的postProcessBeforeInitialization（预初始化）方法</p> <ul><li>作用是在Bean实例创建成功后对进行增强处理，如对Bean进行修改，增加某个功能</li></ul></li> <li><p><strong>如果Bean实现了InitializingBean接口</strong>，Spring将调用它们的afterPropertiesSet方法，作用与在配置文件中对Bean使用init-method声明初始化的作用一样，都是在Bean的全部属性设置成功后执行的初始化方法。</p></li> <li><p><strong>如果Bean实现了BeanPostProcess接口</strong>，Spring将调用它们的postProcessAfterInitialization（后初始化）方法</p> <ul><li>作用与6的一样，只不过6是在Bean初始化前执行的，而这个是在Bean初始化后执行的，时机不同</li></ul></li> <li><p>经过以上的工作后，Bean将一直驻留在应用上下文中给应用使用，直到应用上下文被销毁</p></li> <li><p><strong>如果Bean实现了DispostbleBean接口</strong>，Spring将调用它的destory方法，作用与在配置文件中对Bean使用destory-method属性的作用一样，都是在Bean实例销毁前执行的方法。</p></li></ol> <h3 id="_4-3-beanfactory-和applicationcontext（bean工厂和应用上下文）"><a href="#_4-3-beanfactory-和applicationcontext（bean工厂和应用上下文）" aria-hidden="true" class="header-anchor">#</a> 4.3 BeanFactory 和ApplicationContext（Bean工厂和应用上下文）</h3> <p>Bean 工厂（com.springframework.beans.factory.BeanFactory）是Spring 框架最核心的接口，它提供了高级IoC 的配置机制。</p> <p>应用上下文（com.springframework.context.ApplicationContext）建立在BeanFactory 基础之上。</p> <p>几乎所有的应用场合我们都直接使用ApplicationContext 而非底层的BeanFactory。</p> <div align="center"><img src="/fullstack-tutorial-site/assets/img/beanfactory.e63c6da9.jpg" width></div><br> <p>ApplicationContext 的初始化和BeanFactory有一个重大的区别：</p> <ul><li>BeanFactory在初始化容器时，并未实例化Bean，直到第一次访问某个Bean 时才实例目标Bean；</li> <li>而ApplicationContext 则在初始化应用上下文时就实例化所有单实例的Bean 。</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code>ApplicationContext ctx = new ClassPathXmlApplicationContext(&quot;com/baobaotao/context/beans.xml&quot;);
ApplicationContext ctx = new FileSystemXmlApplicationContext(&quot;com/baobaotao/context/beans.xml&quot;);
ApplicationContext ctx = new ClassPathXmlApplicationContext(new String[]{&quot;conf/beans1.xml&quot;,&quot;conf/beans2.xml&quot;});
</code></pre></div><p>参考资料：</p> <ul><li><a href="http://www.pinhuba.com/spring/101250.htm" target="_blank" rel="noopener noreferrer">BeanFactory 和ApplicationContext（Bean工厂和应用上下文） - 品互网络<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/frank-lam/fullstack-tutorial/edit/master/docs/notes/JavaWeb/Spring.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">12/20/2018, 12:56:39 PM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/fullstack-tutorial-site/assets/js/app.e23029aa.js" defer></script><script src="/fullstack-tutorial-site/assets/js/4.020e03fa.js" defer></script>
  </body>
</html>
